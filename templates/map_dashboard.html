{% extends "base.html" %}

{% block title %}US Map Dashboard - Prospector{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
    /* Simple map styles */
    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
    }
</style>
{% endblock %}

{% block content %}
<div id="map-container" style="height: 100vh; width: 100vw; position: fixed; top: 0; left: 0; z-index: 9999; background: #e9ecef; border: 5px solid #007bff;">
    <div style="position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.95); padding: 10px; border-radius: 4px; font-size: 16px; z-index: 1001; border: 2px solid #007bff; font-weight: bold;">
        üó∫Ô∏è MAP TEST - FULL SCREEN
    </div>
    <div id="us-map" style="height: 100%; width: 100%;"></div>
    
    <div style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.95); padding: 10px; border-radius: 4px; font-size: 14px; z-index: 1001;">
        <a href="{{ url_for('index') }}" class="btn btn-sm btn-outline-secondary">Back to Dashboard</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
console.log('Simple map test - loading...');

// Simple map initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing simple map...');
    
    // Wait for Leaflet to load
    setTimeout(function() {
        if (typeof L !== 'undefined') {
            console.log('Leaflet available, creating map...');
            createSimpleMap();
        } else {
            console.log('Loading Leaflet manually...');
            loadLeafletManually();
        }
    }, 1000);
    
    function loadLeafletManually() {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';
        script.onload = function() {
            console.log('Leaflet loaded manually, creating map...');
            createSimpleMap();
        };
        script.onerror = function() {
            console.error('Failed to load Leaflet');
        };
        document.head.appendChild(script);
    }
    
    function createSimpleMap() {
        try {
            console.log('Creating simple map...');
            
            // Create the map
            const map = L.map('us-map').setView([39.8283, -98.5795], 4);
            console.log('Map created successfully');
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            console.log('Tile layer added');
            
            // Add a simple marker to test
            L.marker([39.8283, -98.5795]).addTo(map)
                .bindPopup('Map is working! This is the center of the US.')
                .openPopup();
            console.log('Test marker added');
            
        } catch (error) {
            console.error('Error creating map:', error);
        }
    }
});
</script>
{% endblock %}
